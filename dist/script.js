import{Tab as e,TabContainer as t}from"./classes.js";var n=document.querySelector("input");n.focus();const o=new t;async function l(){var e=await chrome.tabs.query({});document.querySelector("#tabCount").innerHTML=e.length}async function i(){o.clearElems();var t=await chrome.tabs.query({}),n=await async function(){let[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return e}(),i=document.querySelector("input").value.toLowerCase();const c=[...function*(){for(let e of t)(e.title.toLowerCase().includes(i)||e.url.toLowerCase().includes(i))&&(yield e)}()];document.querySelector("#resultCount").innerHTML=c.length;const a=new Intl.Collator;c.sort(((e,t)=>a.compare(e.title,t.title)));const r=document.getElementById("li_template");for(const t of c){const i=r.content.firstElementChild.cloneNode(!0),c=new e(i,t,n);c.setContents(),c.aElem.addEventListener("click",(async e=>{e.ctrlKey?c.selectTab():await c.focusWindowTab()})),c.closeButton.addEventListener("click",(async e=>{e.stopPropagation(),await o.closeTab(c.id),await l()})),c.markIfCurrentTab(),o.add(c)}o.showAll(),await l()}await l(),await i(),n.addEventListener("keyup",function(e,t){let n;return(...o)=>{clearTimeout(n),n=setTimeout((function(){e.apply(this,o)}),t)}}((async()=>{i()}),250));document.querySelector("button#purge").addEventListener("click",(async()=>{await o.purgeDisplayed(),await l()})),document.addEventListener("keyup",(function(e){function t(e){var t=document.querySelectorAll("body > ul > li"),n=document.querySelectorAll(".selected");if(0==n.length)o=t[0];else{var o=n[0];o.classList.remove("selected"),"up"==e?o=null!=o.previousSibling?o.previousSibling:o:"down"==e&&(o=null!=o.nextSibling?o.nextSibling:null!=o.previousSibling?o.previousSibling:o)}null!=o&&(o.classList.add("selected"),o.scrollIntoView())}if(document.activeElement!=document.querySelector("input"))if("k"==e.key)t("down");else if("j"==e.key)t("up");else if("Delete"==e.key){document.querySelectorAll(".selected").forEach((e=>{e.querySelector(".tabContainer > .closeDiv > button").click()})),t("down")}}));