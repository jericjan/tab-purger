import{Tab as e,TabContainer as t}from"./classes.js";var n=document.querySelector("input");n.focus();const l=new t(c);async function o(){var e=await chrome.tabs.query({});document.querySelector("#tabCount").innerHTML=e.length}async function c(){l.clearElems();var t=await chrome.tabs.query({}),n=await async function(){let[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return e}(),c=document.querySelector("input").value.toLowerCase();function a(e,t){for(const n of t)if(e.includes(n))return!0;return!1}const i=[...function*(){for(let e of t){const t=e.title.toLowerCase().includes(c)||e.url.toLowerCase().includes(c),n=a(e.title.toLowerCase(),l.blacklist)||a(e.url.toLowerCase(),l.blacklist);t&&!n&&(yield e)}}()];document.querySelector("#resultCount").innerHTML=i.length;const s=new Intl.Collator;i.sort(((e,t)=>s.compare(e.title,t.title)));const r=document.getElementById("li_template");for(const t of i){const c=r.content.firstElementChild.cloneNode(!0),a=new e(c,t,n);a.setContents(),a.element.addEventListener("click",(async e=>{e.ctrlKey?a.selectTab():await a.focusWindowTab()})),a.closeButton.addEventListener("click",(async e=>{e.stopPropagation(),await l.closeTab(a.id),await o()})),a.markIfCurrentTab(),l.add(a)}l.showAll(),await o()}l.loadBlacklist(),await o(),await c(),n.addEventListener("keyup",function(e,t){let n;return(...l)=>{clearTimeout(n),n=setTimeout((function(){e.apply(this,l)}),t)}}((async()=>{c()}),250));document.querySelector("button#purge").addEventListener("click",(async()=>{await l.purgeDisplayed(),await o()})),document.addEventListener("keyup",(async function(e){async function t(e){var t=document.querySelectorAll("body > ul > li"),n=document.querySelectorAll(".selected");if(0==n.length)l=t[0];else{var l=n[0];l.classList.remove("selected"),"up"==e?l=null!=l.previousSibling?l.previousSibling:l:"down"==e&&(l=null!=l.nextSibling?l.nextSibling:null!=l.previousSibling?l.previousSibling:l)}null!=l&&(l.classList.add("selected"),l.scrollIntoView(),await chrome.storage.local.set({lastSelectedTab:l.children[0].id}))}if(document.activeElement!=document.querySelector("input"))if("k"==e.key)await t("down");else if("j"==e.key)await t("up");else if("Delete"==e.key){document.querySelectorAll(".selected").forEach((e=>{e.querySelector(".tabContainer > .closeDiv > button").click()})),await t("down")}})),document.querySelector("#blacklistBtn").addEventListener("click",(async()=>{await l.onBlacklistBtnClick.bind(l)(document.querySelector("input").value)}));const a=await chrome.storage.local.get("lastSelectedTab");if(0!=Object.keys(a).length&&""!=a.lastSelectedTab){const e=document.querySelector("#"+a.lastSelectedTab);if(null!=e){document.activeElement.blur();const t=e.parentElement;t.classList.add("selected"),t.scrollIntoView()}}